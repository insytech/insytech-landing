---
import BtnLink from "../shared/BtnLink.astro";
import Container from "../shared/Container.astro";

// Estructura mejorada de navegación con submenús
const navItems = [
    {
        href: "/",
        text: "Inicio",
    },
    {
        href: "#about-us",
        text: "Soluciones",
        hasDropdown: true,
        dropdownItems: [
            {
                href: "#infoguard",
                text: "Desarrollo de Software y Automatización",
            },
            {
                href: "#industrial-vision",
                text: "Trazabilidad y Monitoreo de Producción",
            },
            { href: "#planner", text: "Automatización y Control" },
            {
                href: "#industrial-vision",
                text: "Visión con Inteligencia Artificial",
            },
        ],
    },
    {
        href: "/Blog",
        text: "Blog",
    },
];
---

<header
    id="header"
    class="fixed w-full top-0 left-0 z-50 transition-all duration-300"
>
    <Container>
        <div
            class="relative z-40 bg-white bg-opacity-90 backdrop-blur-md rounded-full py-3 px-6 shadow-lg border border-gray-200/50 dark:bg-gray-900/80 dark:border-gray-700/50"
        >
            <nav class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="/" class="flex items-center">
                        <img
                            src="/images/Versiones de logotipo-01.webp"
                            alt="Insytech Logo"
                            class="h-12 dark:hidden"
                        />
                        <img
                            src="/images/Insytech-logo-dark.webp"
                            alt="Insytech Logo Dark"
                            class="h-12 hidden dark:block"
                        />
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div
                    class="hidden lg:flex lg:items-center lg:justify-center flex-1 px-10"
                >
                    <ul class="flex space-x-8">
                        {
                            navItems.map((item) => (
                                <li class="relative group">
                                    <a
                                        href={item.href}
                                        class="text-heading-2 font-medium text-lg py-2 hover:text-primary transition-colors duration-300 flex items-center"
                                    >
                                        {item.text}
                                        {item.hasDropdown && (
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4 ml-1"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                    clip-rule="evenodd"
                                                />
                                            </svg>
                                        )}
                                    </a>

                                    {/* Decorative underline indicator */}
                                    <span class="absolute left-0 bottom-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full" />

                                    {/* Dropdown menu */}
                                    {item.hasDropdown && (
                                        <div class="absolute left-0 top-full w-72 z-50 opacity-0 translate-y-2 pointer-events-none transition-all duration-300 group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:translate-y-0 group-focus-within:pointer-events-auto">
                                            <div class="pt-3" />
                                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-4 border border-gray-100 dark:border-gray-700">
                                                <ul class="space-y-2">
                                                    {item.dropdownItems &&
                                                        item.dropdownItems.map(
                                                            (dropdownItem) => (
                                                                <li>
                                                                    <a
                                                                        href={
                                                                            dropdownItem.href
                                                                        }
                                                                        class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-heading-2 hover:text-primary transition-colors duration-200"
                                                                    >
                                                                        {
                                                                            dropdownItem.text
                                                                        }
                                                                    </a>
                                                                </li>
                                                            ),
                                                        )}
                                                </ul>
                                            </div>
                                        </div>
                                    )}
                                </li>
                            ))
                        }
                    </ul>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Theme switcher -->
                    <button
                        data-switch-theme
                        class="outline-none flex items-center justify-center w-10 h-10 rounded-full text-heading-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                        aria-label="Cambiar tema"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="w-5 h-5 dark:flex hidden"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
                            ></path>
                        </svg>
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="w-5 h-5 dark:hidden"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
                            ></path>
                        </svg>
                    </button>

                    <!-- CTA Button -->
                    <div class="hidden lg:block">
                        <BtnLink
                            text="Contáctanos"
                            href="/Contact"
                            className="flex justify-center"
                            variant="primary"
                        />
                    </div>

                    <!-- Mobile menu button -->
                    <button
                        data-toggle-nav
                        data-open-nav="false"
                        class="lg:hidden outline-none flex flex-col items-center justify-center"
                        aria-label="Abrir menú"
                    >
                        <span
                            id="line1"
                            class="w-6 h-0.5 rounded-full bg-heading-2 transition-all duration-300 ease-linear"
                        ></span>
                        <span
                            id="line2"
                            class="w-6 origin-center mt-1 h-0.5 rounded-full bg-heading-2 transition-all duration-300 ease-linear"
                        ></span>
                        <span
                            id="line3"
                            class="w-6 mt-1 h-0.5 rounded-full bg-heading-2 transition-all duration-300 ease-linear"
                        ></span>
                    </button>
                </div>
            </nav>
        </div>
    </Container>

    <!-- Mobile navigation overlay -->
    <div
        data-nav-overlay
        aria-hidden="true"
        class="fixed hidden inset-0 lg:!hidden bg-box-bg bg-opacity-50 backdrop-filter backdrop-blur-xl"
    >
    </div>

    <!-- Mobile navigation menu -->
    <div
        data-navbar
        class="lg:!hidden fixed inset-x-0 top-20 h-0 overflow-hidden duration-300 ease-linear flex flex-col w-full bg-body border-t border-box-border shadow-xl"
    >
        <Container className="flex flex-col py-4">
            <ul
                class="flex flex-col gap-y-5 text-lg text-heading-2 font-medium"
            >
                {
                    navItems.map((item) => (
                        <li>
                            <a
                                href={item.href}
                                class="flex items-center justify-between py-2 hover:text-primary"
                            >
                                {item.text}
                                {item.hasDropdown && (
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-4 w-4"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M19 9l-7 7-7-7"
                                        />
                                    </svg>
                                )}
                            </a>
                            {item.hasDropdown && (
                                <ul class="pl-4 mt-2 space-y-2 border-l border-box-border">
                                    {item.dropdownItems &&
                                        item.dropdownItems.map(
                                            (dropdownItem) => (
                                                <li>
                                                    <a
                                                        href={dropdownItem.href}
                                                        class="block py-2 hover:text-primary"
                                                    >
                                                        {dropdownItem.text}
                                                    </a>
                                                </li>
                                            ),
                                        )}
                                </ul>
                            )}
                        </li>
                    ))
                }
            </ul>
            <div class="mt-8">
                <BtnLink
                    text="Contáctanos"
                    href="/Contact"
                    className="flex justify-center w-full"
                    variant="primary"
                />
            </div>
        </Container>
    </div>
</header>

<script>
    // Añadir clase cuando se hace scroll
    document.addEventListener("DOMContentLoaded", () => {
        const header = document.getElementById("header");

        if (header) {
            window.addEventListener("scroll", () => {
                if (window.scrollY > 50) {
                    header.classList.add("scrolled");
                } else {
                    header.classList.remove("scrolled");
                }
            });
        }
    });
</script>

<script>
    const switchTheme = document.querySelector(
        "[data-switch-theme]",
    ) as HTMLButtonElement;

    if (
        localStorage.getItem("appTheme") === "dark" ||
        (!("appTheme" in localStorage) &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
        document.documentElement.classList.add("dark");
    } else {
        document.documentElement.classList.remove("dark");
    }
    if (switchTheme) {
        switchTheme.addEventListener("click", (e) => {
            e.preventDefault();
            const doc = document.documentElement;
            if (doc) {
                if (localStorage.getItem("appTheme")) {
                    if (localStorage.getItem("appTheme") === "light") {
                        doc.classList.add("dark");
                        localStorage.setItem("appTheme", "dark");
                    } else {
                        document.documentElement.classList.remove("dark");
                        localStorage.setItem("appTheme", "light");
                    }
                } else {
                    if (doc.classList.contains("dark")) {
                        doc.classList.remove("dark");
                        localStorage.setItem("appTheme", "light");
                    } else {
                        doc.classList.add("dark");
                        localStorage.setItem("appTheme", "dark");
                    }
                }
            }
        });
    }
</script>
<script>
    const toggleMenu = document.querySelector(
        "[data-toggle-nav]",
    ) as HTMLButtonElement;
    const navbar = document.querySelector("[data-navbar]") as HTMLDivElement;
    const overlayNav = document.querySelector(
        "[data-nav-overlay]",
    ) as HTMLDivElement;
    if (toggleMenu) {
        toggleMenu.addEventListener("click", (e) => {
            e.preventDefault();
            if (toggleMenu.getAttribute("data-open-nav") === "false") {
                toggleMenu.setAttribute("data-open-nav", "true");
                overlayNav.setAttribute("data-is-visible", "true");
                document.body.classList.add("!overflow-y-hidden");
                navbar.style.height = `${navbar.scrollHeight}px`;
            } else {
                toggleMenu.setAttribute("data-open-nav", "false");
                overlayNav.setAttribute("data-is-visible", "false");
                document.body.classList.remove("!overflow-y-hidden");
                navbar.style.height = "0px";
            }
        });

        navbar.addEventListener("click", () => {
            toggleMenu.setAttribute("data-open-nav", "false");
            overlayNav.setAttribute("data-is-visible", "false");
            document.body.classList.remove("!overflow-y-hidden");
            navbar.style.height = "0px";
        });

        overlayNav.addEventListener("click", () => {
            toggleMenu.setAttribute("data-open-nav", "false");
            overlayNav.setAttribute("data-is-visible", "false");
            document.body.classList.remove("!overflow-y-hidden");
            navbar.style.height = "0px";
        });
    }
</script>

<style>
    /* Animación para el botón móvil */
    [data-toggle-nav][data-open-nav="true"] #line1 {
        transform: translateY(0.375rem) rotate(45deg);
    }
    [data-toggle-nav][data-open-nav="true"] #line2 {
        transform: scaleX(0);
        opacity: 0;
    }
    [data-toggle-nav][data-open-nav="true"] #line3 {
        transform: translateY(-0.375rem) rotate(-45deg);
    }
</style>
